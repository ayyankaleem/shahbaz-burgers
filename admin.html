<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - Shahbaz Bhai</title>
    <!-- Fonts & Icons -->
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&family=Poppins:wght@500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #FFC107;
            --dark: #121212;
            --card: #1E1E1E;
            --text: #fff;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--dark);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1,
        h2 {
            font-family: 'Poppins', sans-serif;
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #ccc;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px;
            background: #2a2a2a;
            border: 1px solid #444;
            color: #fff;
            border-radius: 5px;
            font-family: inherit;
            box-sizing: border-box;
        }

        button {
            padding: 10px 20px;
            background: var(--primary);
            border: none;
            color: #000;
            font-weight: 700;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            opacity: 0.9;
        }

        .btn-danger {
            background: #dc3545;
            color: #fff;
        }

        .btn-success {
            background: #28a745;
            color: #fff;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        .tab-btn {
            background: transparent;
            color: #aaa;
            border: 1px solid transparent;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Lists */
        .item-list {
            margin-top: 20px;
        }

        .list-item {
            background: var(--card);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-info h3 {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
            color: #fff;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        /* Image Preview */
        #image-preview,
        #hero-preview,
        #logo-preview {
            max-width: 200px;
            max-height: 200px;
            margin-top: 10px;
            display: none;
            border: 1px solid #444;
        }

        /* Media Query for Admin Dashboard */
        @media (max-width: 600px) {
            .stats-bar {
                grid-template-columns: 1fr !important;
            }

            .list-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .item-actions {
                width: 100%;
                justify-content: space-between;
            }

            .item-actions button {
                flex: 1;
            }
        }
    </style>
</head>

<body>

    <!-- Login -->
    <div id="login-section"
        style="max-width: 400px; margin: 100px auto; text-align: center; background: var(--card); padding: 40px; border-radius: 10px;">
        <h2>Admin Login</h2>
        <div class="form-group"><input type="password" id="password" placeholder="Enter Admin Password"></div>
        <button onclick="checkLogin()">Login</button>
        <p id="error-msg" style="color: red; display: none; margin-top: 10px;">Incorrect Password!</p>
    </div>

    <!-- Dashboard -->
    <div id="dashboard-section" class="container" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h1>Dashboard</h1>
            <a href="index.html" target="_blank" style="color: var(--primary);">View Website <i
                    class="fas fa-external-link-alt"></i></a>
        </div>

        <!-- Stats Summary -->
        <div class="stats-bar" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
            <div onclick="openProfitModal()"
                style="background: var(--card); padding: 20px; border-radius: 10px; border-left: 5px solid var(--primary); display: flex; align-items: center; gap: 15px; cursor: pointer;">
                <div
                    style="background: rgba(255, 193, 7, 0.1); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 1.5rem;">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div>
                    <span style="color: #aaa; font-size: 0.9rem;">Today's Sale (Click to view)</span>
                    <h2 style="margin: 0; font-size: 1.5rem;">Rs. <span id="today-sale">0</span></h2>
                </div>
            </div>
            <div
                style="background: var(--card); padding: 20px; border-radius: 10px; border-left: 5px solid #dc3545; display: flex; align-items: center; gap: 15px;">
                <div
                    style="background: rgba(220, 53, 69, 0.1); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #dc3545; font-size: 1.5rem;">
                    <i class="fas fa-clock"></i>
                </div>
                <div>
                    <span style="color: #aaa; font-size: 0.9rem;">Pending Orders</span>
                    <h2 style="margin: 0; font-size: 1.5rem;"><span id="pending-count">0</span></h2>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('products', event)">Menu Items</button>
            <button class="tab-btn" onclick="switchTab('orders', event)">Orders <span id="order-count"
                    style="background: red; color: white; padding: 2px 6px; border-radius: 50%; font-size: 0.8rem; display: none;">0</span></button>
            <button class="tab-btn" onclick="switchTab('settings', event)">Site Settings</button>
        </div>

        <!-- PRODUCTS TAB -->
        <div id="tab-products" class="tab-content active">
            <div style="background: var(--card); padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                <h2 style="font-size: 1.5rem; margin-top: 0;">Add / Edit Product</h2>
                <input type="hidden" id="edit-id">
                <div class="form-group"><label>Name</label><input type="text" id="p-name"></div>
                <div class="form-group"><label>Price (Rs)</label><input type="number" id="p-price"></div>
                <div class="form-group"><label>Category</label>
                    <select id="p-category">
                        <option value="Burgers">Burgers</option>
                        <option value="Shawarma">Shawarma</option>
                        <option value="Sandwiches">Sandwiches</option>
                        <option value="Rolls & Sides">Rolls & Sides</option>
                        <option value="Drinks">Drinks</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Image (Upload File)</label>
                    <input type="file" id="p-file" accept="image/*" onchange="handleImageUpload()">
                    <input type="hidden" id="p-image-base64">
                    <img id="image-preview" src="" alt="Preview">
                </div>
                <div class="form-group"><label>Description</label><textarea id="p-desc" rows="3"></textarea></div>
                <button onclick="saveProduct()" id="save-btn">Add Product</button>
                <button onclick="resetForm()" style="background: #555; margin-top: 10px; display: none;"
                    id="cancel-btn">Cancel</button>
            </div>
            <h2>Current Menu</h2>
            <div id="product-list" class="item-list"></div>
        </div>

        <!-- ORDERS TAB -->
        <div id="tab-orders" class="tab-content">
            <h2>Recent Orders</h2>
            <div id="order-list" class="item-list"></div>
        </div>

        <!-- SETTINGS TAB -->
        <div id="tab-settings" class="tab-content">
            <div style="background: var(--card); padding: 20px; border-radius: 10px;">
                <h2>Site Text Configuration</h2>
                <div class="form-group"><label>Shop Name (HTML allowed)</label><input type="text" id="c-shopName"></div>
                <div class="form-group"><label>Phone Number</label><input type="text" id="c-phone"></div>
                <div class="form-group"><label>Address</label><input type="text" id="c-address"></div>
                <div class="form-group"><label>Hero Title (HTML allowed)</label><input type="text" id="c-heroTitle">
                </div>
                <div class="form-group"><label>Hero Subtitle</label><input type="text" id="c-heroSubtitle"></div>
                <div class="form-group"><label>Hero Description</label><textarea id="c-heroDesc" rows="3"></textarea>
                </div>

                <h3 style="margin-top: 30px; color: var(--primary);">Hero Image (Premium Burger)</h3>
                <div class="form-group">
                    <label>Upload Main Image</label>
                    <input type="file" id="c-heroFile" accept="image/*" onchange="handleHeroUpload()">
                    <input type="hidden" id="c-heroImage-base64">
                    <img id="hero-preview" src="" alt="Hero Preview">
                </div>

                <h3 style="margin-top: 30px; color: var(--primary);">Shop Logo</h3>
                <div class="form-group">
                    <label>Upload Logo</label>
                    <input type="file" id="c-logoFile" accept="image/*" onchange="handleLogoUpload()">
                    <input type="hidden" id="c-logoImage-base64">
                    <img id="logo-preview" src="" alt="Logo Preview" style="background: #fff; padding: 10px;">
                </div>

                <button onclick="saveSettings()" style="margin-bottom: 30px; display: block; width: 100%;">Save Site
                    Settings</button>

                <hr style="border-color: #333; margin: 30px 0;">

                <h2 style="color: var(--primary);">Admin Security</h2>
                <div style="background: #252525; padding: 20px; border-radius: 10px;">
                    <div class="form-group">
                        <label>Current Password</label>
                        <input type="password" id="old-pass" placeholder="Enter current password">
                    </div>
                    <div class="form-group">
                        <label>New Password</label>
                        <input type="password" id="new-pass" placeholder="Enter new password">
                    </div>
                    <button onclick="changePassword()" class="btn-success">Update Password</button>

                    <hr style="border-color: #444; margin: 20px 0;">
                    <h3 style="color: #ff4444; font-size: 1rem;">System Tools</h3>
                    <p style="color: #888; font-size: 0.8rem; margin-bottom: 10px;">If your space is full or pictures
                        stop saving, use this to start fresh.</p>
                    <button onclick="clearAllData()" class="btn-danger"
                        style="width: 100%; border: 1px solid #ff4444; background: transparent; color: #ff4444;">Clear
                        All Saved Data</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Profit Modal -->
    <div id="profit-modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; align-items: center; justify-content: center; padding: 20px;">
        <div
            style="background: var(--card); padding: 30px; border-radius: 15px; width: 100%; max-width: 600px; max-height: 80vh; overflow-y: auto; border: 1px solid var(--primary);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">Sales Analysis</h2>
                <button onclick="closeProfitModal()" style="background: transparent; color: #fff; font-size: 1.5rem;"><i
                        class="fas fa-times"></i></button>
            </div>

            <div id="profit-content">
                <!-- Sales List Here -->
            </div>

            <hr style="border-color: #333; margin: 20px 0;">
            <div style="display: flex; gap: 10px;">
                <button onclick="resetSales()" class="btn-danger" style="flex: 1;">Restart Today's Profit</button>
                <button onclick="closeProfitModal()" style="background: #555; flex: 1;">Close</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>

    <!-- Scripts -->
    <script src="data.js"></script>
    <script>
        // Auth
        function checkLogin() {
            const storedPass = dataManager.getAdminPassword();
            if (document.getElementById('password').value === storedPass) {
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('dashboard-section').style.display = 'block';
                loadAll();
            } else { document.getElementById('error-msg').style.display = 'block'; }
        }

        async function loadAll() {
            // 1. Instant Render from Cache
            loadProducts();
            loadSettings();

            // 2. Background Sync
            if (dataManager.syncFromFirebase) {
                dataManager.syncFromFirebase().then(() => {
                    loadProducts();
                    loadSettings();
                });
            }

            // 3. Real-time Order Listening
            if (dataManager.listenToOrders) {
                dataManager.listenToOrders((updatedOrders) => {
                    loadOrders();
                });
            } else {
                loadOrders();
                setInterval(loadOrders, 5000);
            }

            window.addEventListener('storage', (e) => {
                if (e.key === 'shahbaz_orders') loadOrders();
            });
        }

        function switchTab(tabName, event) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabName).classList.add('active');

            // Use event to find the clicked button
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
        }

        // --- IMAGE COMPRESSION HELPER ---
        function compressImage(file, maxWidth, callback) {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function (event) {
                const img = new Image();
                img.src = event.target.result;
                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;

                    if (width > maxWidth) {
                        height *= maxWidth / width;
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);

                    // Compress to JPEG with 0.7 quality
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.7);
                    callback(dataUrl);
                }
            }
        }

        // --- UPLOAD HANDLERS ---
        function handleImageUpload() {
            const file = document.getElementById('p-file').files[0];
            if (file) {
                compressImage(file, 800, function (base64) {
                    document.getElementById('p-image-base64').value = base64;
                    document.getElementById('image-preview').src = base64;
                    document.getElementById('image-preview').style.display = 'block';
                });
            }
        }

        function handleHeroUpload() {
            const file = document.getElementById('c-heroFile').files[0];
            if (file) {
                compressImage(file, 1000, function (base64) {
                    document.getElementById('c-heroImage-base64').value = base64;
                    document.getElementById('hero-preview').src = base64;
                    document.getElementById('hero-preview').style.display = 'block';
                });
            }
        }

        function handleLogoUpload() {
            const file = document.getElementById('c-logoFile').files[0];
            if (file) {
                compressImage(file, 400, function (base64) {
                    document.getElementById('c-logoImage-base64').value = base64;
                    document.getElementById('logo-preview').src = base64;
                    document.getElementById('logo-preview').style.display = 'block';
                });
            }
        }

        // --- PRODUCTS LOGIC ---
        function loadProducts() {
            const list = document.getElementById('product-list');
            list.innerHTML = '';
            dataManager.getProducts().forEach(p => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <div class="item-info">
                        <h3>${p.name} <span style="font-size: 0.8rem; color: #aaa;">(${p.category})</span></h3>
                        <span style="color: var(--primary);">Rs. ${p.price}</span>
                    </div>
                    <div class="item-actions">
                        <button onclick="editProduct('${p.id}')">Edit</button>
                        <button class="btn-danger" onclick="deleteProduct('${p.id}')">Delete</button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        async function saveProduct() {
            const id = document.getElementById('edit-id').value;
            const product = {
                id: id || Date.now(),
                name: document.getElementById('p-name').value,
                price: parseInt(document.getElementById('p-price').value),
                category: document.getElementById('p-category').value,
                image: document.getElementById('p-image-base64').value,
                description: document.getElementById('p-desc').value
            };
            if (!product.name || !product.price) return alert('Name/Price required');

            try {
                id ? await dataManager.updateProduct(product) : await dataManager.addProduct(product);
                resetForm(); loadProducts(); alert('Saved!');
            } catch (e) {
                alert('Storage Full! Please use smaller images or delete old items.');
            }
        }

        function editProduct(id) {
            const p = dataManager.getProducts().find(x => x.id === id);
            document.getElementById('edit-id').value = p.id;
            document.getElementById('p-name').value = p.name;
            document.getElementById('p-price').value = p.price;
            document.getElementById('p-category').value = p.category;
            document.getElementById('p-desc').value = p.description;
            document.getElementById('p-image-base64').value = p.image || '';
            if (p.image) {
                document.getElementById('image-preview').src = p.image;
                document.getElementById('image-preview').style.display = 'block';
            }
            document.getElementById('save-btn').innerText = 'Update Product';
            document.getElementById('cancel-btn').style.display = 'inline-block';
            window.scrollTo(0, 0);
        }

        async function deleteProduct(id) { if (confirm('Delete?')) { await dataManager.deleteProduct(id); loadProducts(); } }

        function resetForm() {
            document.querySelectorAll('input').forEach(i => i.value = '');
            document.getElementById('p-desc').value = '';
            document.getElementById('image-preview').style.display = 'none';
            document.getElementById('save-btn').innerText = 'Add Product';
            document.getElementById('cancel-btn').style.display = 'none';
        }

        // --- ORDERS LOGIC ---
        function loadOrders() {
            const list = document.getElementById('order-list');
            list.innerHTML = '';
            const orders = dataManager.getOrders();

            // Calculate Stats
            const today = new Date().toLocaleDateString();
            let todayTotal = 0;
            let pendingCount = 0;

            orders.forEach(o => {
                let dateObj = o.createdAt && o.createdAt.toDate ? o.createdAt.toDate() : new Date(o.id);
                if (isNaN(dateObj.getTime())) dateObj = new Date(); // Fallback

                const orderDate = dateObj.toLocaleDateString();
                if (orderDate === today) {
                    todayTotal += parseInt(o.total) || 0;
                }
                if (o.status === 'Pending') pendingCount++;
            });

            // Update UI Stats
            document.getElementById('today-sale').innerText = todayTotal.toLocaleString();
            document.getElementById('pending-count').innerText = pendingCount;

            // Update Tab Badge
            const badge = document.getElementById('order-count');
            if (pendingCount > 0) { badge.innerText = pendingCount; badge.style.display = 'inline-block'; }
            else { badge.style.display = 'none'; }

            if (orders.length === 0) { list.innerHTML = '<p>No orders yet.</p>'; return; }

            orders.forEach(o => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.style.borderLeft = o.status === 'Pending' ? '4px solid red' : '4px solid green';
                item.innerHTML = `
                    <div class="item-info">
                        <h3>Order #${o.id} <span style="font-size:0.8rem">(${o.date})</span></h3>
                        <p style="color: #aaa; font-size: 0.9rem;">${o.customerName} - ${o.phone}</p>
                        <p style="color: #fff;">${o.items}</p>
                        ${o.message ? `<p style="color: var(--primary); font-weight: 500; background: #333; padding: 5px; border-radius: 5px; display: inline-block;">Note: ${o.message}</p>` : ''}
                        <p style="font-weight:bold; color: var(--primary); font-size: 1.1rem;"><i class="fas fa-coins" style="margin-right: 5px;"></i>Total: Rs. ${o.total}</p>
                        <p style="color: #ccc; font-style: italic;">Address: ${o.address}</p>
                    </div>
                    <div class="item-actions">
                        ${o.status === 'Pending' ? `<button class="btn-success" onclick="completeOrder('${o.id}')">Complete</button>` : '<span style="color:green; margin-right: 10px;">Completed</span>'}
                        <button class="btn-danger" onclick="deleteOrder('${o.id}')"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        function completeOrder(id) { dataManager.updateOrderStatus(id, 'Completed'); loadOrders(); }
        function deleteOrder(id) { if (confirm('Delete Order?')) { dataManager.deleteOrder(id); loadOrders(); } }

        // --- SETTINGS LOGIC ---
        function loadSettings() {
            const c = dataManager.getConfig();
            document.getElementById('c-shopName').value = c.shopName;
            document.getElementById('c-phone').value = c.contactPhone;
            document.getElementById('c-address').value = c.contactAddress;
            document.getElementById('c-heroTitle').value = c.heroTitle;
            document.getElementById('c-heroSubtitle').value = c.heroSubtitle;
            document.getElementById('c-heroDesc').value = c.heroDescription;

            document.getElementById('c-heroImage-base64').value = c.heroImage || '';
            if (c.heroImage) {
                document.getElementById('hero-preview').src = c.heroImage;
                document.getElementById('hero-preview').style.display = 'block';
            }

            document.getElementById('c-logoImage-base64').value = c.logoImage || '';
            if (c.logoImage) {
                document.getElementById('logo-preview').src = c.logoImage;
                document.getElementById('logo-preview').style.display = 'block';
            }
        }

        function saveSettings() {
            const config = {
                shopName: document.getElementById('c-shopName').value,
                contactPhone: document.getElementById('c-phone').value,
                contactAddress: document.getElementById('c-address').value,
                heroTitle: document.getElementById('c-heroTitle').value,
                heroSubtitle: document.getElementById('c-heroSubtitle').value,
                heroDescription: document.getElementById('c-heroDesc').value,
                heroImage: document.getElementById('c-heroImage-base64').value,
                logoImage: document.getElementById('c-logoImage-base64').value
            };
            dataManager.saveConfig(config);
            alert('Settings Saved! Refresh website to see changes.');
        }

        function changePassword() {
            const oldPass = document.getElementById('old-pass').value;
            const newPass = document.getElementById('new-pass').value;
            const currentStored = dataManager.getAdminPassword();

            if (oldPass !== currentStored) {
                alert('Current password incorrect!');
                return;
            }
            if (newPass.length < 4) {
                alert('New password must be at least 4 characters!');
                return;
            }

            dataManager.saveAdminPassword(newPass);
            alert('Password updated successfully!');
            document.getElementById('old-pass').value = '';
            document.getElementById('new-pass').value = '';
        }

        function clearAllData() {
            if (confirm('Warning: This will delete ALL your products and settings. Are you sure?')) {
                localStorage.clear();
                alert('All data cleared. Refreshing...');
                location.reload();
            }
        }

        // --- PROFIT LOGIC ---
        function openProfitModal() {
            document.getElementById('profit-modal').style.display = 'flex';
            const orders = dataManager.getOrders();
            const today = new Date().toLocaleDateString();
            const container = document.getElementById('profit-content');

            let itemCounts = {};
            let totalProfit = 0;

            orders.forEach(o => {
                let dateObj = o.createdAt && o.createdAt.toDate ? o.createdAt.toDate() : new Date(o.id);
                if (isNaN(dateObj.getTime())) dateObj = new Date();

                if (dateObj.toLocaleDateString() === today) {
                    totalProfit += parseInt(o.total) || 0;
                    // Parse items: "Zinger x1, Fries x2"
                    const itemsArr = o.items.split(', ');
                    itemsArr.forEach(itemStr => {
                        const parts = itemStr.split(' x');
                        const name = parts[0];
                        const qty = parseInt(parts[1]) || 1;
                        itemCounts[name] = (itemCounts[name] || 0) + qty;
                    });
                }
            });

            let html = `<div style="margin-bottom: 20px; font-size: 1.2rem; color: var(--primary);">Total Sale Today: <strong>Rs. ${totalProfit}</strong></div>`;
            html += `<table style="width: 100%; border-collapse: collapse;">
                <tr style="border-bottom: 1px solid #444; color: #aaa;">
                    <th style="text-align: left; padding: 10px;">Item</th>
                    <th style="text-align: right; padding: 10px;">Sold Qty</th>
                </tr>`;

            for (const [name, qty] of Object.entries(itemCounts)) {
                html += `
                    <tr style="border-bottom: 1px solid #2a2a2a;">
                        <td style="padding: 10px;">${name}</td>
                        <td style="padding: 10px; text-align: right; font-weight: bold; color: var(--primary);">${qty}</td>
                    </tr>
                `;
            }
            html += `</table>`;

            if (Object.keys(itemCounts).length === 0) {
                html = '<p style="text-align: center; color: #888;">No sales recorded for today.</p>';
            }

            container.innerHTML = html;
        }

        function closeProfitModal() {
            document.getElementById('profit-modal').style.display = 'none';
        }

        async function resetSales() {
            if (confirm('Aap aaj ki sari sales data khatam karna chahte hain? (Only for today)')) {
                const orders = dataManager.getOrders();
                const today = new Date().toLocaleDateString();

                // Delete today's orders from Firebase (if using) and local
                for (const o of orders) {
                    let dateObj = o.createdAt && o.createdAt.toDate ? o.createdAt.toDate() : new Date(o.id);
                    if (dateObj.toLocaleDateString() === today) {
                        await dataManager.deleteOrder(o.id);
                    }
                }
                alert('Profit reset ho gaya!');
                closeProfitModal();
                loadOrders();
            }
        }
    </script>
</body>

</html>